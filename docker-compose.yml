version: "3.8"

services:
  fava:
    container_name: fava
    build:
      context: ./fava
      args:
        port: 5000
    network_mode: "host"
    volumes:
      - ./fava:/fava/
    command: ["/fava/ledger.beancount"]
    restart: unless-stopped

  home-assistant:
    container_name: home-assistant
    init: true
    image: homeassistant/home-assistant:stable
    network_mode: "host"
    environment:
      TZ: "Europe/Rome"
    volumes:
      - ./home-assistant:/config
    restart: unless-stopped

  code-server:
    image: ghcr.io/linuxserver/code-server
    container_name: code-server
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/London
    volumes:
      - ./code-config:/config
      - /home:/home
    ports:
      - 8443:8443
    restart: unless-stopped

  mariadb:
    image: ghcr.io/linuxserver/mariadb
    container_name: mariadb
    environment:
      - PUID=1000
      - PGID=1000
      - FILE__MYSQL_ROOT_PASSWORD=./root-password
      - TZ=Europe/Rome
    volumes:
      - ./mariadb-config:/config
    ports:
      - 3306:3306
    restart: unless-stopped

  fleet:
    image: ghcr.io/linuxserver/fleet
    container_name: fleet
    environment:
      - PUID=1000
      - PGID=1000
      - fleet_admin_authentication_type=DATABASE
      - fleet_database_url=jdbc:mariadb://localhost:3306/fleet
      - fleet_database_username=fleet_user
      - fleet_database_password=dbuserpassword
    volumes:
      - ./fleet-config:/config
    ports:
      - 8080:8080
    restart: unless-stopped
